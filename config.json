{
  "_comment": "This config is for REFERENCE ONLY. Notebooks are self-contained via widgets.",

  "project_defaults": {
    "project_name": "lakebase-branching-demo",
    "display_name": "Lakebase Branching Demo",
    "pg_version": 17,
    "compute": {
      "autoscaling_limit_min_cu": 0.5,
      "autoscaling_limit_max_cu": 4.0,
      "suspend_timeout_seconds": 60
    }
  },

  "workspace": {
    "host": "https://e2-demo-field-eng.cloud.databricks.com",
    "workspace_path": "/Workspace/Users/steven.tan@databricks.com/lakebase_branching",
    "_note": "Customers will use their own workspace URL and path"
  },

  "github": {
    "repo": "https://github.com/CheeYuTan/lakebase_branching"
  },

  "references": {
    "api_docs": "https://docs.databricks.com/api/workspace/postgres",
    "branch_management": "https://docs.databricks.com/aws/en/oltp/projects/manage-branches",
    "api_usage_guide": "https://docs.databricks.com/aws/en/oltp/projects/api-usage",
    "python_notebooks": "https://docs.databricks.com/aws/en/oltp/projects/notebooks-python"
  },

  "notebook_widgets": {
    "_description": "Every notebook uses dbutils.widgets for portability. Customers only need to keep project_name consistent across notebooks.",
    "shared_widgets": {
      "project_name": {
        "type": "text",
        "default": "lakebase-branching-demo",
        "label": "Project Name",
        "used_in": "ALL notebooks",
        "note": "The single linking key across all notebooks"
      },
      "db_password": {
        "type": "text",
        "default": "",
        "label": "Database Password",
        "used_in": "All scenario notebooks (01-05)",
        "note": "Password for the Postgres role created via Lakebase UI"
      }
    },
    "per_notebook_widgets": {
      "00_Setup_Project": {
        "project_name": "lakebase-branching-demo",
        "min_cu": "0.5",
        "max_cu": "4.0",
        "suspend_timeout_seconds": "60",
        "pg_version": "17"
      },
      "01_Scenario_Data_Only": {
        "project_name": "lakebase-branching-demo",
        "branch_name": "dev-readonly",
        "ttl_hours": "24",
        "db_password": ""
      },
      "02_Scenario_Schema_To_Prod": {
        "project_name": "lakebase-branching-demo",
        "branch_name": "feature-loyalty-tier",
        "ttl_hours": "168",
        "db_password": ""
      },
      "03_Scenario_Concurrent": {
        "project_name": "lakebase-branching-demo",
        "branch_name_1": "feature-order-priority",
        "branch_name_2": "feature-order-priority-v2",
        "ttl_hours": "48",
        "db_password": ""
      },
      "04_Scenario_Point_In_Time": {
        "project_name": "lakebase-branching-demo",
        "recovery_minutes_ago": "5",
        "db_password": ""
      },
      "05_Scenario_CICD_Ephemeral": {
        "project_name": "lakebase-branching-demo",
        "ttl_hours": "1",
        "num_ci_branches": "3"
      },
      "99_Cleanup": {
        "project_name": "lakebase-branching-demo",
        "delete_project": "no"
      }
    }
  },

  "scenarios": {
    "scenario_0_setup": {
      "notebook": "notebooks/00_Setup_Project.py",
      "description": "Create Lakebase project, seed e-commerce schema and data",
      "branches_created": [],
      "sql_embedded": true,
      "sql_reference_files": ["sql/001_seed_schema.sql", "sql/002_seed_data.sql"],
      "prerequisites": ["Lakebase enabled in workspace", "CAN MANAGE permission"]
    },
    "scenario_1_data_only": {
      "notebook": "notebooks/01_Scenario_Data_Only.py",
      "description": "Production data in dev — no schema changes, just query safely",
      "branches_created": ["dev-readonly"],
      "branch_strategy": "current_data",
      "default_ttl_hours": 24,
      "sql_embedded": true,
      "depends_on": ["scenario_0_setup"]
    },
    "scenario_2_schema_to_prod": {
      "notebook": "notebooks/02_Scenario_Schema_To_Prod.py",
      "description": "Add loyalty_tier column on branch, validate, replay migration on main",
      "branches_created": ["feature-loyalty-tier"],
      "branch_strategy": "current_data",
      "default_ttl_hours": 168,
      "sql_embedded": true,
      "sql_reference_files": ["sql/003_add_loyalty_tier.sql"],
      "depends_on": ["scenario_0_setup"],
      "modifies_main": true,
      "schema_changes": ["ALTER TABLE customers ADD COLUMN loyalty_tier"]
    },
    "scenario_3_concurrent": {
      "notebook": "notebooks/03_Scenario_Concurrent.py",
      "description": "Production drifts while you develop — discover and resolve conflicts",
      "branches_created": ["feature-order-priority", "feature-order-priority-v2"],
      "branch_strategy": "current_data",
      "default_ttl_hours": 48,
      "sql_embedded": true,
      "sql_reference_files": ["sql/004_add_email_verified.sql", "sql/005_add_order_priority.sql"],
      "depends_on": ["scenario_0_setup", "scenario_2_schema_to_prod"],
      "modifies_main": true,
      "schema_changes": [
        "ALTER TABLE customers ADD COLUMN email_verified",
        "ALTER TABLE orders ADD COLUMN priority"
      ]
    },
    "scenario_4_point_in_time": {
      "notebook": "notebooks/04_Scenario_Point_In_Time.py",
      "description": "Recover from accidental data wipe using point-in-time branching",
      "branches_created": ["recovery-branch"],
      "branch_strategy": "past_data",
      "default_ttl_hours": 24,
      "sql_embedded": true,
      "depends_on": ["scenario_0_setup", "scenario_2_schema_to_prod"],
      "modifies_main": true,
      "note": "Temporarily wipes loyalty_tier data on main, then restores it"
    },
    "scenario_5_cicd": {
      "notebook": "notebooks/05_Scenario_CICD_Ephemeral.py",
      "description": "CI/CD-style ephemeral branches with auto-expiration",
      "branches_created": ["ci-pr-42-abc123", "ci-pr-43-def456", "ci-pr-44-ghi789"],
      "branch_strategy": "current_data",
      "default_ttl_hours": 1,
      "sql_embedded": true,
      "depends_on": ["scenario_0_setup"],
      "note": "Independent of scenarios 2-4; can run after setup"
    },
    "cleanup": {
      "notebook": "notebooks/99_Cleanup.py",
      "description": "Delete all branches and optionally the project",
      "branches_created": [],
      "depends_on": []
    }
  },

  "sql_migrations": {
    "_note": "SQL is embedded in notebooks for portability. These files exist in sql/ for reference only.",
    "001_seed_schema.sql": "Initial e-commerce tables (customers, products, orders, order_items)",
    "002_seed_data.sql": "Sample data: 100 customers, 50 products, 200 orders",
    "003_add_loyalty_tier.sql": "ALTER TABLE customers ADD COLUMN loyalty_tier + backfill",
    "004_add_email_verified.sql": "Simulated 'other team' change: ALTER TABLE customers ADD COLUMN email_verified",
    "005_add_order_priority.sql": "Your feature: ALTER TABLE orders ADD COLUMN priority"
  },

  "execution_order": {
    "full_demo": [
      "00_Setup_Project",
      "01_Scenario_Data_Only",
      "02_Scenario_Schema_To_Prod",
      "03_Scenario_Concurrent",
      "04_Scenario_Point_In_Time",
      "05_Scenario_CICD_Ephemeral",
      "99_Cleanup"
    ],
    "standalone_scenarios": {
      "01": ["00_Setup_Project", "01_Scenario_Data_Only", "99_Cleanup"],
      "02": ["00_Setup_Project", "02_Scenario_Schema_To_Prod", "99_Cleanup"],
      "05": ["00_Setup_Project", "05_Scenario_CICD_Ephemeral", "99_Cleanup"]
    },
    "note": "Scenarios 3 and 4 require scenario 2 to run first (cumulative schema changes)"
  }
}
